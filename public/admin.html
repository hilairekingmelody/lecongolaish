<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Publier un article</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 500px;
      margin: auto;
      padding: 20px;
    }
    input, textarea, select, button {
      width: 100%;
      margin-bottom: 15px;
      padding: 10px;
      font-size: 1em;
    }
    button {
      background-color: #007bff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>
<body>

  <h2>ğŸ” AccÃ¨s admin</h2>
  <script>
    const adminKey = prompt("Entrez la clÃ© admin pour publier");
    if (adminKey !== "congolais2025") {
      alert("â›” AccÃ¨s refusÃ©");
      window.location.href = "/";
    }
  </script>

  <h2>ğŸ“ Publier un article</h2>
   
  <a href="dashboard.html">Accueil</a>
  <form id="articleForm">
    <input type="text" name="title" placeholder="Titre de l'article" required>
    <textarea name="description" placeholder="Description" required></textarea>
    <input type="text" name="url" placeholder="Lien (facultatif)">
    
    <select name="category" required>
      <option value="Congo">Congo</option>
      <option value="Politique">Politique</option>
      <option value="Ã‰conomie">Ã‰conomie</option>
      <option value="Culture">Culture</option>
      <option value="Monde">Monde</option>
    </select>

    <input type="file" name="image" accept="image/*" required>
    <button type="submit">ğŸ“¤ Publier</button>
  </form>

  <script>
    const CLOUD_NAME = 'lecongolaish';
    const UPLOAD_PRESET = 'lecongolaish';

    document.getElementById('articleForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const form = e.target;
      const imageFile = form.image.files[0];

      if (!imageFile) {
        alert("âŒ Veuillez sÃ©lectionner une image");
        return;
      }

      // ğŸ”¼ Upload image vers Cloudinary
  const formData = new FormData();
formData.append('file', imageFile);
formData.append('upload_preset', 'lecongolaish');
formData.append('folder', 'articles');

fetch('https://api.cloudinary.com/v1_1/dkglpx7jh/image/upload', {
  method: 'POST',
  body: formData
})
.then(res => res.json())
.then(data => {
  console.log("âœ… Image URL :", data.secure_url);
})
.catch(err => {
  console.error("âŒ Erreur Cloudinary :", err);
});


      // ğŸ“ Publier lâ€™article vers ton backend
      const article = {
        title: form.title.value,
        description: form.description.value,
        url: form.url.value,
        category: form.category.value,
        image: cloudData.secure_url
      };

      const res = await fetch('/articles', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'x-admin-key': 'congolais2025'
        },
        body: JSON.stringify(article)
      });

      if (res.ok) {
        alert("âœ… Article publiÃ© !");
        form.reset();
      } else {
        alert("âŒ Erreur lors de la publication");
      }
    });
  </script>

</body>
</html>

